'use client';

import StampcrushWhiteLogo from '@/public/stampcrush_logo_white.svg';
import {
  Container,
  EmptyContent,
  LabelContent,
  LogoHeader,
  LogoImgWrapper,
  LogoutButton,
  LogoutContainer,
  SideBarContainer,
  SideBarContent,
} from './style';
import { useEffect, useState } from 'react';
import PiBookOpenTextLight from '@/public/book_open_text.svg';
import PiBuildingsLight from '@/public/buildings.svg';
import PiGiftLight from '@/public/gift.svg';
import PiStampLight from '@/public/stamp.svg';
import PiUserListLight from '@/public/user_list.svg';
import { IoIosLogOut } from '@react-icons/all-files/io/IoIosLogOut';

import { useRouter, usePathname } from 'next/navigation';
import { Option, RouterPath } from '@/app/types';
import { ROUTER_PATH } from '@/app/constants';

const SIDE_BAR_OPTIONS: Option[] = [
  { key: '', value: '' },
  { key: 'ÎÇ¥ Í≥†Í∞ù Î™©Î°ù', value: ROUTER_PATH.customerList },
  { key: 'ÎÇ¥ Ïπ¥Ìéò Í¥ÄÎ¶¨', value: ROUTER_PATH.manageCafe },
  { key: 'Ïø†Ìè∞ Ï†úÏûë Î∞è Î≥ÄÍ≤Ω', value: ROUTER_PATH.modifyCouponPolicy },
  { key: 'Ïä§ÌÉ¨ÌîÑ Ï†ÅÎ¶Ω', value: ROUTER_PATH.enterStamp },
  { key: 'Î¶¨ÏõåÎìú ÏÇ¨Ïö©', value: ROUTER_PATH.enterReward },
  { key: '', value: '' },
];

const SIDEBAR_ICONS = [
  <></>,
  <PiUserListLight width={26} height={26} key="user-list" />,
  <PiBuildingsLight width={26} height={26} key="user-list" />,
  <PiBookOpenTextLight width={26} height={26} key="user-list" />,
  <PiStampLight width={26} height={26} key="user-list" />,
  <PiGiftLight width={26} height={26} key="user-list" />,
  <></>,
];

const SideBar = () => {
  const router = useRouter();
  const current = usePathname();
  const [isDesignCoupon, setIsDesignCoupon] = useState(false);
  const [isEarnStamp, setIsEarnStamp] = useState(false);
  const [isUseReward, setIsUseReward] = useState(false);
  const [currentIndex, setCurrentIndex] = useState(
    SIDE_BAR_OPTIONS.findIndex((option) => option.value === current) + 1
  );

  const modifyPolicyCoupon = ROUTER_PATH.modifyCouponPolicy;
  const designCouponRoutes = [
    ROUTER_PATH.templateCouponDesign,
    ROUTER_PATH.customCouponDesign,
  ];
  const enterStamp = ROUTER_PATH.enterStamp;
  const stampRoutes = [ROUTER_PATH.earnStamp];
  const enterReward = ROUTER_PATH.enterReward;
  const rewardRoutes = [ROUTER_PATH.useReward];

  useEffect(() => {
    const foundIndex = SIDE_BAR_OPTIONS.findIndex(({ value }) => {
      if (checkIncludeRoute(value, modifyPolicyCoupon, designCouponRoutes)) {
        setIsDesignCoupon(true);
        return true;
      }

      if (checkIncludeRoute(value, enterStamp, stampRoutes)) {
        setIsEarnStamp(true);
        return true;
      }

      if (checkIncludeRoute(value, enterReward, rewardRoutes)) {
        setIsUseReward(true);
        return true;
      }

      return value === current;
    });

    setCurrentIndex(foundIndex + 1);
  }, [current]);

  const handleLogout = () => {
    alert('Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§');
  };

  const checkIncludeRoute = (
    value: string,
    route: string,
    routes: string[]
  ) => {
    if (value !== route) return false;
    return routes.some((route) => current!.includes(route));
  };

  const routeSideBar = (index: number) => () => {
    if (current === ROUTER_PATH.registerCafe) {
      alert('Ïπ¥Ìéò Îì±Î°ù ÌõÑ ÏÇ¨Ïö©ÌïòÏã§ Ïàò ÏûàÎäî ÏÑúÎπÑÏä§ÏûÖÎãàÎã§. üòÑ');
      return;
    }
    if (index === 0 || index === SIDE_BAR_OPTIONS.length - 1) return;

    setCurrentIndex(index + 1);

    router.push(SIDE_BAR_OPTIONS[index].value);
  };

  const navigateCustomerList = () => {
    router.push(ROUTER_PATH.customerList);
  };

  return (
    <Container>
      <LogoHeader $currentIndex={currentIndex}>
        <LogoImgWrapper>
          <StampcrushWhiteLogo
            width={150}
            height={30}
            onClick={navigateCustomerList}
          />
        </LogoImgWrapper>
      </LogoHeader>
      <SideBarContainer
        $prevIndex={currentIndex - 1}
        $nextIndex={currentIndex + 1}
      >
        {SIDE_BAR_OPTIONS.map(({ key, value }, index) => {
          if (index === 0 || index === SIDE_BAR_OPTIONS.length - 1)
            return <EmptyContent />;
          return (
            <SideBarContent
              key={key}
              $isSelected={
                value === current ||
                (checkIncludeRoute(
                  value,
                  modifyPolicyCoupon,
                  designCouponRoutes
                ) &&
                  isDesignCoupon) ||
                (checkIncludeRoute(value, enterStamp, stampRoutes) &&
                  isEarnStamp) ||
                (checkIncludeRoute(value, enterReward, rewardRoutes) &&
                  isUseReward)
              }
              $currentIndex={index + 1}
            >
              <LabelContent
                $isSelected={
                  value === current ||
                  (checkIncludeRoute(
                    value,
                    modifyPolicyCoupon,
                    designCouponRoutes
                  ) &&
                    isDesignCoupon) ||
                  (checkIncludeRoute(value, enterStamp, stampRoutes) &&
                    isEarnStamp) ||
                  (checkIncludeRoute(value, enterReward, rewardRoutes) &&
                    isUseReward)
                }
                onClick={routeSideBar(index)}
              >
                {SIDEBAR_ICONS[index]}
                {key}
              </LabelContent>
            </SideBarContent>
          );
        })}
      </SideBarContainer>
      <LogoutContainer $currentIndex={currentIndex}>
        <LogoutButton onClick={handleLogout}>
          <IoIosLogOut size="26px" />
          Î°úÍ∑∏ÏïÑÏõÉ
        </LogoutButton>
      </LogoutContainer>
    </Container>
  );
};

export default SideBar;
